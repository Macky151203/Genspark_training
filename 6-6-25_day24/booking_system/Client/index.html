<!DOCTYPE html>
<html>

<head>
    <title>SignalR File Upload</title>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.7/dist/browser/signalr.min.js"></script>
    <script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("http://localhost:5136/eventhub", { withCredentials: true })
        .build();

    connection.on("ReceiveMessage", (user, message) => {
        const placeHolder = document.getElementById("msgs");
        const content = document.createElement("p");
        content.innerHTML = `${user} - ${message}`;
        placeHolder.append(content);
    });

    connection.start()
        .then(() => console.log("Connected to SignalR"))
        .catch(err => console.error("SignalR connection failed", err));

    connection.onclose(err => {
        console.warn("Connection closed", err);
    });

    window.addEventListener("beforeunload", () => {
        connection.stop();
    });

    function sendMessage(e) {
        e.preventDefault();
        const user = document.getElementById("user").value;
        const message = document.getElementById("message").value;
        connection.invoke("SendMessage", user, message)
            .catch(err => console.error("SendMessage failed:", err));
    }
</script>
</head>

<body>
    <h2>SignalR Demo</h2>

    <input type="text" id="user" placeholder="username" />
    <input type="text" id="message" placeholder="Message" />
    <button onclick="sendMessage(event)">Send</button>



    <div id="msgs"></div>

    

</body>

</html>